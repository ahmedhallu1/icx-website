<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AIESEC in Alexandria</title>
  <link rel="icon" href="Favicon.png" type="image/png">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="site.css">
</head>
<body class="flex flex-col min-h-screen">
  <nav class="site-nav">
    <div class="nav-inner container mx-auto">
      <a href="index.html" class="flex items-center gap-3">
        <img src="aiesec-logo.png" alt="AIESEC logo" class="h-10 md:h-12">
      </a>
      <div class="nav-links">
        <a href="index.html" class="nav-link active">Home</a>
        <a href="why-alex.html" class="nav-link">Why Alex</a>
        <a href="stories.html" class="nav-link">EPs Stories</a>
        <a href="contact.html" class="nav-link">Contact us</a>
        <div class="dropdown" data-dropdown>
          <button class="dropdown-button" type="button" data-dropdown-button aria-expanded="false" aria-controls="opportunity-menu">
            Opportunities
            <svg aria-hidden="true" viewBox="0 0 20 20" class="w-4 h-4">
              <path fill="currentColor" d="M5 7l5 6 5-6H5z" />
            </svg>
          </button>
          <div class="dropdown-panel" id="opportunity-menu" data-dropdown-panel role="menu">
            <a class="dropdown-item" href="index.html?category=Global%20Volunteer#opportunities" data-opportunity="Global Volunteer">Global Volunteer</a>
            <a class="dropdown-item" href="index.html?category=Global%20Talent#opportunities" data-opportunity="Global Talent">Global Talent</a>
            <a class="dropdown-item" href="index.html?category=Global%20Teacher#opportunities" data-opportunity="Global Teacher">Global Teacher</a>
          </div>
        </div>
      </div>
      <button class="nav-toggle" type="button" data-mobile-toggle aria-expanded="false" aria-controls="mobile-menu">
        <span class="nav-toggle-line"></span>
        <span class="nav-toggle-line"></span>
        <span class="nav-toggle-line"></span>
        <span class="sr-only">Open menu</span>
      </button>
    </div>
    <div class="mobile-menu" id="mobile-menu" data-mobile-menu>
      <div class="container mx-auto px-6">
        <a href="index.html" class="mobile-link active">Home</a>
        <a href="why-alex.html" class="mobile-link">Why Alex</a>
        <a href="stories.html" class="mobile-link">EPs Stories</a>
        <a href="contact.html" class="mobile-link">Contact us</a>
        <div class="mobile-divider"></div>
        <div class="dropdown mobile-dropdown" data-dropdown>
          <button class="dropdown-button" type="button" data-dropdown-button aria-expanded="false" aria-controls="mobile-opportunity-menu">
            Opportunities
            <svg aria-hidden="true" viewBox="0 0 20 20" class="w-4 h-4">
              <path fill="currentColor" d="M5 7l5 6 5-6H5z" />
            </svg>
          </button>
          <div class="dropdown-panel" id="mobile-opportunity-menu" data-dropdown-panel role="menu">
            <a class="dropdown-item" href="index.html?category=Global%20Volunteer#opportunities" data-opportunity="Global Volunteer">Global Volunteer</a>
            <a class="dropdown-item" href="index.html?category=Global%20Talent#opportunities" data-opportunity="Global Talent">Global Talent</a>
            <a class="dropdown-item" href="index.html?category=Global%20Teacher#opportunities" data-opportunity="Global Teacher">Global Teacher</a>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <header class="hero">
    <div class="hero-bg parallax-layer" data-depth="0.08" data-speed="0.14"></div>

    <div class="hero-content container mx-auto">
      <h1 class="hero-title font-bold">Alexandria</h1>
      <p class="hero-subtitle">The Pearl of the Mediterranean</p>
    </div>
  </header>

  <section id="safety-index" class="section reveal" data-reveal="right">
    <div class="container mx-auto px-6">
      <div class="surface safety-panel">
        <div class="safety-content">
          <div class="badge">2025 Safety Index</div>
          <h2 class="section-title">The safest city in Africa</h2>
          <p class="section-subtitle">Alexandria leads 2025 safety index for African cities. Recognized for its secure, welcoming environment for residents and international participants.</p>
        </div>
        <div class="safety-link">
          <a class="btn-ghost" href="https://thepeninsulaqatar.com/article/20/01/2026/alexandria-leads-2025-safety-index-for-african-cities" target="_blank" rel="noopener">Read the source</a>
        </div>
      </div>
    </div>
  </section>

  <section id="alexandria-video" class="section reveal" data-reveal="left">
    <div class="container mx-auto px-6">
      <div class="surface flex flex-col lg:flex-row gap-10 items-stretch lg:items-center">
        <div class="lg:w-1/2">
          <div class="badge mb-4">City in motion</div>
          <h2 class="section-title">See Alexandria from the shore</h2>
          <p class="section-subtitle">A short cinematic glimpse of the sea, the streets, and the spirit of Alexandria.</p>
        </div>
        <div class="lg:w-1/2 w-full self-stretch video-column">
          <div class="video-frame">
            <iframe src="https://drive.google.com/file/d/1y3uPb3A6rKYubF2etqnOJ7RB5qT-JTty/preview" title="Alexandria video" allow="autoplay" loading="lazy"></iframe>
          </div>
          <p class="text-sm text-mist mt-3">Video credit: Elmamony Bmx</p>
        </div>
      </div>
    </div>
  </section>

  <section id="opportunities" class="section reveal" data-reveal="up">
    <div class="container mx-auto px-6 text-center">
      <h2 class="section-title">Choose your path</h2>
      <p class="section-subtitle mx-auto">Select a program to explore open positions tailored to your goals.</p>
      <div class="opportunity-grid mt-10 md:grid-cols-3">
        <div class="opportunity-card">
          <div class="program-panel volunteer">
            <img src="GV TOP RIGHT WHITE.png" alt="Global Volunteer mark" class="program-mark">
          </div>
          <button class="opportunity-cta" type="button" data-opportunity="Global Volunteer">View Openings</button>
        </div>
        <div class="opportunity-card">
          <div class="program-panel talent">
            <img src="GTA TOP RIGHT WHITE.png" alt="Global Talent mark" class="program-mark">
          </div>
          <button class="opportunity-cta" type="button" data-opportunity="Global Talent">View Openings</button>
        </div>
        <div class="opportunity-card">
          <div class="program-panel teacher">
            <img src="GTE TOP RIGHT WHITE.png" alt="Global Teacher mark" class="program-mark">
          </div>
          <button class="opportunity-cta" type="button" data-opportunity="Global Teacher">View Openings</button>
        </div>
      </div>
    </div>
  </section>

  <section id="listings" class="section-tight hidden">
    <div class="container mx-auto px-6">
      <div class="listings-panel reveal" data-reveal="up">
        <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-6 mb-6">
          <h3 id="category-title" class="text-2xl"></h3>
          <div id="filters-area" class="flex flex-wrap gap-3 hidden">
            <select id="filter-dynamic" onchange="applyFilters()" class="filter-select">
              <option value="all">All</option>
            </select>
            <select id="filter-duration" onchange="applyFilters()" class="filter-select">
              <option value="all">All Durations</option>
            </select>
          </div>
        </div>
        <div id="cards-container" class="grid md:grid-cols-2 xl:grid-cols-3 gap-6"></div>
      </div>
    </div>
  </section>

  <section id="application-process" class="section reveal" data-reveal="right">
    <div class="container mx-auto px-6">
      <div class="text-center mb-12">
        <h2 class="section-title">Application Process</h2>
        <p class="section-subtitle mx-auto">Two clear tracks to guide your journey from application to realization.</p>
      </div>
      <div class="process-grid md:grid-cols-2">
        <div class="process-card volunteer">
          <h3>
            <img src="GV LOGO COLOR.png" alt="Global Volunteer logo" class="process-logo">
            Incoming Global Volunteer (IGV)
          </h3>
          <ul>
            <li><span class="step-index">1</span>Apply</li>
            <li><span class="step-index">2</span>Interview</li>
            <li><span class="step-index">3</span>Get Accepted</li>
            <li><span class="step-index">4</span>Get Approved</li>
            <li><span class="step-index">5</span>Realization</li>
          </ul>
        </div>
        <div class="process-card talent">
          <h3>
            <img src="GTA LOGO COLOR.png" alt="Global Talent logo" class="process-logo">
            Incoming Global Talent (IGT)
          </h3>
          <ul>
            <li><span class="step-index">1</span>Apply</li>
            <li><span class="step-index">2</span>Interview with Host</li>
            <li><span class="step-index">3</span>Interview with Partner</li>
            <li><span class="step-index">4</span>Get Accepted</li>
            <li><span class="step-index">5</span>Realization</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <section id="visa" class="section reveal" data-reveal="left">
    <div class="container mx-auto px-6">
      <div class="visa-panel">
        <div class="badge mb-4">Find your visa category</div>
        <h2 class="section-title">Find your visa category</h2>
        <p class="section-subtitle">Check the available visa types for your country before arriving in Egypt.</p>
        <div class="visa-links">
          <a class="visa-link" href="#visa">E-Visa</a>
          <a class="visa-link" href="#visa">Tourist Visa</a>
          <a class="visa-link" href="#visa">Visa on Arrival</a>
          <a class="visa-link" href="#visa">Free Visa</a>
          <a class="visa-link" href="#visa">Visa Extension protocol</a>
        </div>
        <div class="visa-form">
          <label for="visa-country" class="text-mist">Enter your country</label>
          <input id="visa-country" class="visa-input" type="text" placeholder="e.g., Spain" list="visa-country-list" autocomplete="off">
          <datalist id="visa-country-list"></datalist>
          <button id="visa-search" class="btn-primary" type="button">Check visa type</button>
        </div>
        <div id="visa-result" class="visa-result"></div>
      </div>
    </div>
  </section>

  <footer class="footer mt-auto">
    <div class="container mx-auto px-6 footer-grid md:grid-cols-3">
      <div class="text-center md:text-left">
        <h4 class="text-xl font-semibold text-gold">AIESEC in Alexandria</h4>
        <p class="text-mist">Developing Leadership since 1995.</p>
      </div>
      <div class="text-center">
        <div class="social-links">
          <a href="https://www.facebook.com/aiesecegypt" target="_blank" rel="noopener" aria-label="Facebook">
            <img src="facebook.png" alt="Facebook">
          </a>
          <a href="https://www.instagram.com/aiesecinalexandria?igsh=NmtiN2VidXlpZzNp" target="_blank" rel="noopener" aria-label="Instagram">
            <img src="instagram.png" alt="Instagram">
          </a>
          <a href="https://www.linkedin.com/company/aiesec-in-egypt1/" target="_blank" rel="noopener" aria-label="LinkedIn">
            <img src="linkedin.png" alt="LinkedIn">
          </a>
        </div>
      </div>
      <div class="text-center md:text-right">
        <p class="text-mist">Created by: <a href="https://www.linkedin.com/in/ahmedhallul" target="_blank" rel="noopener" class="text-gold">Ahmed Hallul</a></p>
      </div>
    </div>
  </footer>

  <script src="site.js"></script>
  <script>
    const N8N_OPPS_URL = 'https://n8n.srv1235027.hstgr.cloud/webhook/opportunities';
    const LOCAL_VISA_JSON = 'visa-data.json';

    const CATEGORY_META = {
      'Global Volunteer': {
        title: 'Global Volunteer Opportunities',
        icon: 'GV LOGO COLOR.png',
        accent: 'var(--volunteer)'
      },
      'Global Talent': {
        title: 'Global Talent Opportunities',
        icon: 'GTA LOGO COLOR.png',
        accent: 'var(--talent)'
      },
      'Global Teacher': {
        title: 'Global Teacher Opportunities',
        icon: 'GTE LOGO COLOR.png',
        accent: 'var(--teacher)'
      }
    };

    let currentData = [];
    let currentCategory = '';

    document.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(window.location.search);
      const requestedCategory = params.get('category');
      if (requestedCategory) {
        // Add a small delay to ensure DOM is fully ready
        setTimeout(() => {
          filterOpportunities(requestedCategory);
        }, 100);
      }

      setupParallax();
      setupVisaLookup();
    });

    function setupParallax() {
      if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
      const layers = document.querySelectorAll('.parallax-layer');
      if (!layers.length) return;

      const state = { mouseX: 0, mouseY: 0, scrollY: 0 };

      window.addEventListener('mousemove', (event) => {
        state.mouseX = event.clientX / window.innerWidth - 0.5;
        state.mouseY = event.clientY / window.innerHeight - 0.5;
      });

      window.addEventListener('scroll', () => {
        state.scrollY = window.scrollY || window.pageYOffset;
      });

      const animate = () => {
        layers.forEach((layer) => {
          const depth = parseFloat(layer.dataset.depth || 0);
          const speed = parseFloat(layer.dataset.speed || 0);
          const translateX = state.mouseX * depth * 60;
          const scrollOffset = state.scrollY * speed * 0.25;
          const translateY = state.mouseY * depth * 40 - scrollOffset;
          layer.style.transform = `translate3d(${translateX}px, ${translateY}px, 0)`;
        });
        window.requestAnimationFrame(animate);
      };

      animate();
    }

    async function setupVisaLookup() {
      const input = document.getElementById('visa-country');
      const button = document.getElementById('visa-search');
      const result = document.getElementById('visa-result');
      const categoryLinks = document.querySelectorAll('.visa-link');
      const countryList = document.getElementById('visa-country-list');
      if (!input || !button || !result) return;

      const escapeHTML = (value) => {
        return String(value)
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/\"/g, '&quot;')
          .replace(/'/g, '&#39;');
      };

      const formatText = (value) => {
        if (!value) return '';
        return escapeHTML(value).replace(/\n+/g, '<br>');
      };

      const normalizeCountry = (value) => {
        return String(value || '')
          .toLowerCase()
          .replace(/[^a-z\s]/g, '')
          .replace(/\s+/g, ' ')
          .trim();
      };

      let visaDB = null;
      let countryKeys = [];
      let countryIndex = new Map();
      try {
        const resp = await fetch(LOCAL_VISA_JSON);
        visaDB = await resp.json();
      } catch (err) {
        if (window.VISA_DATA) {
          visaDB = { visaCategories: window.VISA_DATA.categories, countries: window.VISA_DATA.countries };
        }
      }

      if (visaDB && visaDB.countries) {
        countryKeys = Object.keys(visaDB.countries);
        countryKeys.forEach((country) => {
          const key = normalizeCountry(country);
          if (key && !countryIndex.has(key)) {
            countryIndex.set(key, country);
          }
        });
        if (countryList) {
          countryList.innerHTML = countryKeys.map((country) => `<option value="${escapeHTML(country)}"></option>`).join('');
        }
      }

      const getCountryKey = (query) => {
        const normalized = normalizeCountry(query);
        if (normalized && countryIndex.has(normalized)) {
          return countryIndex.get(normalized);
        }
        const direct = countryKeys.find((country) => country.toLowerCase() === query.toLowerCase());
        return direct || null;
      };

      const lookup = () => {
        const query = input.value.trim();
        if (!query) {
          result.textContent = 'Please enter a country name.';
          return;
        }
        result.textContent = 'Checking visa category...';

        if (!visaDB || !visaDB.countries) {
          result.textContent = 'Visa data not available.';
          return;
        }

        const matchKey = getCountryKey(query);
        const visaType = matchKey ? visaDB.countries[matchKey] : null;
        if (!visaType) {
          result.textContent = 'No visa category found for that country. Choose from the list to avoid typos.';
          return;
        }
        const visaTypes = Array.isArray(visaType) ? visaType : [visaType];
        const typeMarkup = visaTypes
          .filter(Boolean)
          .map((type) => `
            <div class="visa-type-item">
              <span class="visa-type-name">${escapeHTML(type)}</span>
              <button class="visa-details-link" data-visa-type="${escapeHTML(type)}">Details</button>
            </div>
          `)
          .join('');

        result.innerHTML = `
          <div class="visa-result-summary">Visa categories for <strong>${escapeHTML(matchKey)}</strong>:</div>
          <div class="visa-type-list">
            ${typeMarkup}
          </div>
        `;
      };

      const openModal = (type) => {
        if (!visaDB || !visaDB.visaCategories) return;
        const data = visaDB.visaCategories[type];
        if (!data) return;
        
        const overlay = document.createElement('div');
        overlay.className = 'visa-modal';
        
        let contentHTML = '';
        
        // Description
        if (data.description) {
          contentHTML += `<p class="text-mist mb-4">${formatText(data.description)}</p>`;
        }
        
        // Requirements
        if (data.requirements && data.requirements.length > 0) {
          contentHTML += '<div class="visa-section"><h4 class="text-gold font-semibold mb-3">Required Documents:</h4><ol class="visa-list">';
          data.requirements.forEach(req => {
            contentHTML += `<li><span class="visa-num">${escapeHTML(req.number || '')}</span> ${formatText(req.text)}</li>`;
          });
          contentHTML += '</ol></div>';
        }
        
        // Country-specific extras
        if (data.countryExtras && data.countryExtras.length > 0) {
          const groupedExtras = new Map();
          data.countryExtras.forEach((item) => {
            const key = (item.extra || '').trim() || 'None';
            if (!groupedExtras.has(key)) groupedExtras.set(key, []);
            groupedExtras.get(key).push(item.country);
          });

          contentHTML += `
            <div class="visa-section">
              <h4 class="text-gold font-semibold mb-3">Country-Specific Requirements:</h4>
              <div class="visa-table-wrap">
                <table class="visa-table">
                  <thead>
                    <tr>
                      <th>Countries</th>
                      <th>Extra Document</th>
                    </tr>
                  </thead>
                  <tbody>
                    ${Array.from(groupedExtras.entries()).map(([extra, countries]) => `
                      <tr>
                        <td>${countries.filter(Boolean).map((country) => escapeHTML(country)).join(', ')}</td>
                        <td>${extra !== 'None' ? formatText(extra) : '<em>None</em>'}</td>
                      </tr>
                    `).join('')}
                  </tbody>
                </table>
              </div>
            </div>
          `;
        }

        // Application steps
        if (data.applicationSteps && data.applicationSteps.length > 0) {
          const stepsTitle = data.applicationStepsTitle || 'Application steps';
          contentHTML += `<div class="visa-section"><h4 class="text-gold font-semibold mb-3">${formatText(stepsTitle)}</h4><ol class="visa-list">`;
          data.applicationSteps.forEach(step => {
            const note = step.note ? `<span class="visa-step-note">${formatText(step.note)}</span>` : '';
            contentHTML += `<li><span class="visa-num">${escapeHTML(step.number || '')}</span> ${formatText(step.text)}${note}</li>`;
          });
          contentHTML += '</ol></div>';
        }

        // General notes
        if (data.generalNotes && data.generalNotes.length > 0) {
          const notesTitle = data.generalNotesTitle || 'Important Notes';
          contentHTML += `<div class="visa-section"><h4 class="text-gold font-semibold mb-3">${formatText(notesTitle)}</h4><ol class="visa-list">`;
          data.generalNotes.forEach(note => {
            contentHTML += `<li><span class="visa-num">${escapeHTML(note.number || '')}</span> ${formatText(note.text)}</li>`;
          });
          contentHTML += '</ol></div>';
        }
        
        overlay.innerHTML = `
          <div class="visa-modal-card">
            <button class="visa-modal-close" aria-label="Close">&times;</button>
            <h3 class="section-title">${escapeHTML(type)}</h3>
            <div class="visa-modal-body">
              ${contentHTML || '<p class="text-mist">No details provided.</p>'}
            </div>
          </div>`;
        document.body.appendChild(overlay);
        overlay.addEventListener('click', (e) => {
          if (e.target.classList.contains('visa-modal') || e.target.classList.contains('visa-modal-close')) overlay.remove();
        });
      };

      button.addEventListener('click', lookup);
      input.addEventListener('keydown', (event) => { if (event.key === 'Enter') lookup(); });

      result.addEventListener('click', (e) => {
        const btn = e.target.closest('.visa-details-link');
        if (!btn) return;
        const type = btn.dataset.visaType;
        openModal(type);
      });

      categoryLinks.forEach((a) => {
        a.addEventListener('click', (e) => {
          e.preventDefault();
          const type = a.textContent.trim();
          openModal(type);
        });
      });
    }

    async function filterOpportunities(category) {
      currentCategory = category;
      const listings = document.getElementById('listings');
      const container = document.getElementById('cards-container');
      const title = document.getElementById('category-title');
      const meta = CATEGORY_META[category] || { title: `${category} Opportunities` };

      listings.classList.remove('hidden');
      const revealPanel = listings.querySelector('.reveal');
      if (revealPanel) revealPanel.classList.add('is-visible');

      title.innerHTML = `
        <span class="inline-flex items-center gap-3">
          ${meta.icon ? `<img src="${meta.icon}" alt="${category} logo" class="h-8 w-8">` : ''}
          <span>${meta.title}</span>
        </span>`;

      container.innerHTML = `
        <div class="col-span-3 flex flex-col items-center justify-center py-12 gap-4">
          <div class="loading-spinner" aria-hidden="true" style="--spinner-color: ${meta.accent || 'var(--gold-400)'};"></div>
          <div class="text-mist">Loading opportunities...</div>
        </div>`;

      // Scroll to listings section with a slight delay to ensure rendering
      setTimeout(() => {
        listings.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 50);

      try {
        const response = await fetch(N8N_OPPS_URL, { method: 'GET' });
        if (!response.ok) throw new Error('Server Error');
        let allData = await response.json();
        if (!Array.isArray(allData)) allData = [allData];

        currentData = allData.filter((opp) => {
          const id = (opp.id || '').toUpperCase();
          let itemCat = '';

          if (id.startsWith('TA')) itemCat = 'Global Talent';
          else if (id.startsWith('T')) itemCat = 'Global Teacher';
          else if (id.startsWith('V')) itemCat = 'Global Volunteer';

          return itemCat === category;
        });

        setupFilters();
        applyFilters();
      } catch (error) {
        container.innerHTML = '<div class="col-span-3 text-red-300 text-center">Connection Error</div>';
      }
    }

    function setupFilters() {
      const dynamicFilter = document.getElementById('filter-dynamic');
      const durFilter = document.getElementById('filter-duration');
      const filterArea = document.getElementById('filters-area');

      const durations = [...new Set(currentData.map((i) => i.duration).filter((x) => x))];

      durFilter.innerHTML = '<option value="all">All Durations</option>';
      durations.forEach((d) => durFilter.innerHTML += `<option value="${d}">${d}</option>`);

      let options = [];
      let label = 'All';
      let useDynamic = false;

      if (currentCategory.includes('Talent')) {
        options = [...new Set(currentData.map((i) => i.subProduct).filter((x) => x))];
        label = 'All Sub-Products';
        useDynamic = true;
      } else if (currentCategory.includes('Teacher')) {
        options = [...new Set(currentData.map((i) => i.subProduct).filter((x) => x))];
        label = 'All Languages';
        useDynamic = true;
      } else if (currentCategory.includes('Volunteer')) {
        options = [...new Set(currentData.map((i) => i.position).filter((x) => x))];
        label = 'All Projects';
        useDynamic = true;
      }

      dynamicFilter.innerHTML = `<option value="all">${label}</option>`;
      options.forEach((o) => dynamicFilter.innerHTML += `<option value="${o}">${o}</option>`);

      filterArea.classList.remove('hidden');
      if (useDynamic) dynamicFilter.classList.remove('hidden');
      else dynamicFilter.classList.add('hidden');
    }

    function formatSalary(s) {
      if (!s && s !== 0) return '';
      const num = parseFloat(String(s).replace(/[^0-9.]/g, ''));
      if (isNaN(num)) return s;
      return num.toLocaleString('en-US') + ' EGP';
    }

    function applyFilters() {
      const container = document.getElementById('cards-container');
      const dynVal = document.getElementById('filter-dynamic').value;
      const durVal = document.getElementById('filter-duration').value;

      const filtered = currentData.filter((item) => {
        if (dynVal !== 'all') {
          if (currentCategory.includes('Talent') && item.subProduct !== dynVal) return false;
          if (currentCategory.includes('Teacher') && item.subProduct !== dynVal) return false;
          if (currentCategory.includes('Volunteer') && item.position !== dynVal) return false;
        }
        if (durVal !== 'all' && item.duration !== durVal) return false;
        return true;
      });

      container.innerHTML = '';
      if (filtered.length === 0) {
        container.innerHTML = '<p class="col-span-3 text-center text-mist">No results match.</p>';
        return;
      }

      filtered.forEach((opp) => {
        let cardContent = '';
        let accent = 'var(--gold-400)';
        const id = (opp.id || '').toUpperCase();

        if (id.startsWith('TA')) {
          accent = 'var(--talent)';
          cardContent = `
            <h4 class="text-lg font-semibold text-ink">${opp.position}</h4>
            <span class="accent-chip">${opp.subProduct}</span>
            <div class="text-sm text-mist space-y-1">
              <p><strong>Company:</strong> ${opp.company}</p>
              <p><strong>Duration:</strong> ${opp.duration}</p>
              <p><strong>Start Date:</strong> ${opp.startDate}</p>
              <p><strong>Salary:</strong>
                <a href="https://www.numbeo.com/cost-of-living/in/Alexandria" target="_blank" rel="noopener" class="text-gold font-semibold">${formatSalary(opp.salary)}</a>
              </p>
              <p><strong>Openings:</strong> ${opp.openings}</p>
            </div>`;
        } else if (id.startsWith('V')) {
          accent = 'var(--volunteer)';
          cardContent = `
            <h4 class="text-lg font-semibold text-ink">${opp.position}</h4>
            <div class="text-sm text-mist space-y-1">
              <p><strong>Company:</strong> ${opp.company}</p>
              <p><strong>Duration:</strong> ${opp.duration}</p>
              <p><strong>Openings:</strong> ${opp.openings}</p>
            </div>`;
        } else if (id.startsWith('T')) {
          accent = 'var(--teacher)';
          cardContent = `
            <h4 class="text-lg font-semibold text-ink">${opp.position}</h4>
            <span class="accent-chip">${opp.subProduct}</span>
            <div class="text-sm text-mist space-y-1">
              <p><strong>Company:</strong> ${opp.company}</p>
              <p><strong>Duration:</strong> ${opp.duration}</p>
              <p><strong>Start Date:</strong> ${opp.startDate}</p>
              <p><strong>Salary:</strong>
                <a href="https://www.numbeo.com/cost-of-living/in/Alexandria" target="_blank" rel="noopener" class="text-gold font-semibold">${formatSalary(opp.salary)}</a>
              </p>
              <p><strong>Openings:</strong> ${opp.openings}</p>
            </div>`;
        }

        const card = `
          <div class="listing-card" style="--accent: ${accent};">
            <div class="space-y-3">${cardContent}</div>
            <a href="${opp.link}" target="_blank" rel="noopener" class="accent-btn">Details</a>
          </div>`;
        container.innerHTML += card;
      });
    }
  </script>
</body>
</html>

